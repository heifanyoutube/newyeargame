<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ä¸€å­—åƒé‡‘ | ç®¡ç†ç«¯</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500;700;900&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
        :root{
            --primary:#FF6B35;--secondary:#F7931E;--accent:#FFD23F;
            --correct:#00FF88;--incorrect:#FF3366;
            --bg:linear-gradient(135deg,#0A0E27 0%,#1a1f3a 50%,#0d1129 100%);
        }
        body{font-family:'Noto Sans TC',sans-serif;background:var(--bg);color:white;
            min-height:100vh;padding:12px;overflow-x:hidden;}

        .container{max-width:580px;margin:0 auto;padding-bottom:30px;}

        .header{text-align:center;margin-bottom:20px;}
        .logo{font-family:'Orbitron',sans-serif;font-size:clamp(1.3rem,5vw,2rem);font-weight:900;
            background:linear-gradient(135deg,var(--primary),var(--secondary),var(--accent));
            -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
        .sub{color:var(--accent);font-size:.8rem;letter-spacing:2px;text-transform:uppercase;margin-top:4px;}

        /* Setup */
        .panel{background:rgba(0,0,0,.5);border:2px solid var(--primary);border-radius:15px;
            padding:20px;margin-bottom:15px;box-shadow:0 5px 30px rgba(255,107,53,.25);}
        .field{margin-bottom:14px;}
        .field label{display:block;color:var(--accent);font-size:.8rem;margin-bottom:6px;
            text-transform:uppercase;letter-spacing:1px;}
        .field input{width:100%;padding:13px;background:rgba(0,0,0,.7);
            border:2px solid rgba(255,107,53,.3);border-radius:9px;color:white;
            font-size:clamp(1rem,3vw,1.1rem);font-family:'Orbitron',monospace;transition:border-color .2s;}
        .field input:focus{outline:none;border-color:var(--primary);}

        .btn{width:100%;padding:15px;background:linear-gradient(135deg,var(--primary),var(--secondary));
            border:none;border-radius:11px;color:white;font-size:clamp(.9rem,2.5vw,1.1rem);
            font-weight:700;cursor:pointer;box-shadow:0 4px 20px rgba(255,107,53,.4);
            text-transform:uppercase;letter-spacing:1px;}
        .btn:active{transform:scale(.98);}
        .btn-green{background:linear-gradient(135deg,var(--correct),#00CC6A) !important;
            font-size:clamp(1rem,3vw,1.2rem);padding:20px;}

        .status-msg{padding:11px;border-radius:9px;text-align:center;font-size:.88rem;
            background:rgba(0,0,0,.3);color:var(--accent);margin-top:12px;}
        .status-msg.ok{background:rgba(0,255,136,.1);border:1px solid var(--correct);color:var(--correct);}
        .status-msg.err{background:rgba(255,51,102,.1);border:1px solid var(--incorrect);color:var(--incorrect);}

        /* Control */
        .ctrl{display:none;}
        .ctrl.active{display:block;}

        .stats{display:flex;justify-content:space-around;padding:12px;
            background:rgba(0,0,0,.3);border-radius:10px;margin-bottom:14px;}
        .stat{text-align:center;}
        .stat-v{font-family:'Orbitron',monospace;font-size:clamp(1.5rem,5vw,2rem);font-weight:900;
            color:var(--accent);text-shadow:0 0 15px var(--accent);}
        .stat-l{font-size:.72rem;color:rgba(255,255,255,.55);margin-top:3px;text-transform:uppercase;letter-spacing:1px;}

        .prog{height:6px;background:rgba(0,0,0,.5);border-radius:6px;overflow:hidden;margin-bottom:14px;}
        .prog-fill{height:100%;background:linear-gradient(90deg,var(--primary),var(--accent));
            transition:width .3s;box-shadow:0 0 8px var(--primary);width:0%;}

        .q-box{background:rgba(255,107,53,.1);border:2px solid var(--primary);border-radius:14px;
            padding:18px;margin-bottom:14px;}
        .q-label{font-size:.78rem;color:var(--accent);letter-spacing:2px;text-transform:uppercase;margin-bottom:8px;}
        .q-text{font-size:clamp(.95rem,2.5vw,1.2rem);font-weight:700;line-height:1.6;}
        .ans-hint{margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,107,53,.3);
            color:var(--accent);font-size:clamp(.85rem,2.2vw,1rem);}
        .ans-hint strong{color:var(--correct);font-size:clamp(1.2rem,3.5vw,1.5rem);font-weight:900;}

        /* Player items */
        .players-wrap{background:rgba(0,0,0,.45);border:2px solid rgba(255,107,53,.25);
            border-radius:14px;padding:14px;margin-bottom:14px;}
        .pw-title{color:var(--accent);font-size:.8rem;text-transform:uppercase;letter-spacing:1px;margin-bottom:12px;}

        .p-item{display:flex;flex-direction:column;padding:13px;
            background:rgba(255,107,53,.04);border:1px solid rgba(255,107,53,.18);
            border-radius:10px;margin-bottom:11px;}
        .p-item.appeal{background:rgba(255,211,63,.15);border-color:var(--accent);animation:apulse 1s infinite;}
        @keyframes apulse{0%,100%{box-shadow:0 0 18px rgba(255,211,63,.5);}50%{box-shadow:0 0 35px rgba(255,211,63,.85);}}

        .p-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:9px;}
        .p-name{font-weight:700;color:var(--primary);font-size:clamp(.88rem,2.2vw,1rem);}
        .p-ans{font-family:'Orbitron',monospace;font-size:clamp(1.1rem,3.5vw,1.4rem);font-weight:700;color:white;}

        .canvas-preview{width:100%;height:130px;background:rgba(0,0,0,.55);
            border:2px solid rgba(255,107,53,.18);border-radius:8px;margin-bottom:9px;overflow:hidden;}
        .canvas-preview canvas{width:100%;height:100%;display:block;}

        .appeal-badge{display:inline-block;background:var(--accent);color:#0A0E27;
            padding:3px 9px;border-radius:12px;font-size:.7rem;font-weight:700;
            margin-left:8px;animation:badge 0.5s infinite;}
        @keyframes badge{0%,100%{transform:scale(1);}50%{transform:scale(1.1);}}

        .ovr-btns{display:flex;gap:8px;margin-top:6px;}
        .btn-sm{flex:1;padding:11px;font-size:clamp(.78rem,2vw,.9rem);border-radius:8px;
            border:none;color:white;font-weight:700;cursor:pointer;}
        .btn-sm:active{transform:scale(.97);}
        .btn-ok{background:linear-gradient(135deg,var(--correct),#00CC6A);}
        .btn-no{background:linear-gradient(135deg,var(--incorrect),#CC1144);}
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <div class="logo">ç®¡ç†ç«¯</div>
        <div class="sub">ä¸€å­—åƒé‡‘ â€§ æ´¾å°çˆ­éœ¸</div>
    </div>

    <!-- Connection Panel -->
    <div class="panel" id="connPanel">
        <div class="field">
            <label>Database URL</label>
            <input id="dbUrl" type="url" placeholder="https://your-project-default-rtdb.firebaseio.com">
        </div>
        <div class="field">
            <label>API Key</label>
            <input id="apiKey" type="text" placeholder="AIzaSy...">
        </div>
        <div class="field">
            <label>æˆ¿é–“ä»£è™Ÿï¼ˆ4 ä½æ•¸å­—ï¼‰</label>
            <input id="roomInput" type="number" inputmode="numeric" maxlength="4" placeholder="ä¾‹å¦‚ï¼š1234" autofocus>
        </div>
        <button class="btn" onclick="connectAdmin()">é€£ç·šè‡³ä¸»æ§ç«¯</button>
        <div class="status-msg" id="statusMsg">ç­‰å¾…é€£ç·š...</div>
    </div>

    <!-- Control Panel -->
    <div class="ctrl" id="ctrl">
        <div class="stats">
            <div class="stat"><div class="stat-v" id="curQ">0</div><div class="stat-l">ç›®å‰é¡Œè™Ÿ</div></div>
            <div class="stat"><div class="stat-v">100</div><div class="stat-l">ç¸½é¡Œæ•¸</div></div>
        </div>
        <div class="prog"><div class="prog-fill" id="progFill"></div></div>

        <button class="btn btn-green" id="nextBtn" onclick="nextQuestion()">â–¶ ä¸‹ä¸€é¡Œ</button>

        <div class="q-box" id="qBox" style="display:none;">
            <div class="q-label">ç•¶å‰é¡Œç›®</div>
            <div class="q-text" id="qText"></div>
            <div class="ans-hint">æ­£ç¢ºç­”æ¡ˆï¼š<strong id="ansText"></strong></div>
        </div>

        <div class="players-wrap">
            <div class="pw-title">é¸æ‰‹æ›¸å¯«ç‹€æ…‹</div>

            <div class="p-item" id="pi1">
                <div class="p-row">
                    <div><span class="p-name">é¸æ‰‹ 1</span><span class="appeal-badge" id="ab1" style="display:none;">ğŸ”” è«‹æ±‚å¯©æ ¸</span></div>
                    <div class="p-ans" id="pa1">---</div>
                </div>
                <div class="canvas-preview"><canvas id="ac1"></canvas></div>
                <div class="ovr-btns" id="ob1" style="display:none;">
                    <button class="btn-sm btn-ok" onclick="override(1,true)">âœ“ åˆ¤å®šæ­£ç¢º</button>
                    <button class="btn-sm btn-no" onclick="override(1,false)">âœ— åˆ¤å®šéŒ¯èª¤</button>
                </div>
            </div>

            <div class="p-item" id="pi2">
                <div class="p-row">
                    <div><span class="p-name">é¸æ‰‹ 2</span><span class="appeal-badge" id="ab2" style="display:none;">ğŸ”” è«‹æ±‚å¯©æ ¸</span></div>
                    <div class="p-ans" id="pa2">---</div>
                </div>
                <div class="canvas-preview"><canvas id="ac2"></canvas></div>
                <div class="ovr-btns" id="ob2" style="display:none;">
                    <button class="btn-sm btn-ok" onclick="override(2,true)">âœ“ åˆ¤å®šæ­£ç¢º</button>
                    <button class="btn-sm btn-no" onclick="override(2,false)">âœ— åˆ¤å®šéŒ¯èª¤</button>
                </div>
            </div>

            <div class="p-item" id="pi3">
                <div class="p-row">
                    <div><span class="p-name">é¸æ‰‹ 3</span><span class="appeal-badge" id="ab3" style="display:none;">ğŸ”” è«‹æ±‚å¯©æ ¸</span></div>
                    <div class="p-ans" id="pa3">---</div>
                </div>
                <div class="canvas-preview"><canvas id="ac3"></canvas></div>
                <div class="ovr-btns" id="ob3" style="display:none;">
                    <button class="btn-sm btn-ok" onclick="override(3,true)">âœ“ åˆ¤å®šæ­£ç¢º</button>
                    <button class="btn-sm btn-no" onclick="override(3,false)">âœ— åˆ¤å®šéŒ¯èª¤</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
const QUESTIONS=[
    {"q":"è«‹å¯«å‡ºã€Œã„¨ã„¢Ë‡ã€æ•‘çš„ã€Œã„¨ã„¢Ë‡ã€","a":"æŒ½"},{"q":"ã€Œå†æ¥å†å²ã€çš„ã€Œå²ã€æ˜¯å¦æ­£ç¢ºï¼Ÿ(è«‹å¯«æ­£å­—)","a":"å²"},
    {"q":"ã€Œå¯’æš„ã€çš„ã€Œæš„ã€æ€éº¼å¯«ï¼Ÿ","a":"æš„"},{"q":"è«‹å¯«å‡ºã€Œå°·å°¬ã€çš„ã€Œå°¬ã€","a":"å°¬"},
    {"q":"æˆèªå¡«ç©ºï¼šæŒ‰éƒ¨ã€Œã€‡ã€ç­","a":"å°±"},{"q":"ã€Œã„’ã„©ã„¢ËŠã€æŸ“çš„ã€Œã„’ã„©ã„¢ËŠã€æ­£ç¢ºå¯«æ³•ï¼Ÿ","a":"æ¸²"},
    {"q":"è«‹å¯«å‡ºã€Œå½†æ‰­ã€çš„ã€Œå½†ã€","a":"å½†"},{"q":"æˆèªå¡«ç©ºï¼šã€Œã€‡ã€ç«¿è¦‹å½±","a":"ç«‹"},
    {"q":"ã€Œã„Œã„§ã„ ËŠã€é—Šçš„ã€Œã„Œã„§ã„ ËŠã€æ­£ç¢ºå¯«æ³•ï¼Ÿ","a":"é¼"},{"q":"è«‹å¯«å‡ºã€Œè¹£è·šã€çš„ã€Œè¹£ã€","a":"è¹£"},
    {"q":"ã€Œå«»ã€ç†Ÿçš„ã€Œå«»ã€æ€éº¼å¯«ï¼Ÿ","a":"å«»"},{"q":"æˆèªå¡«ç©ºï¼šã€Œã€‡ã€ç²¾æœƒç¥","a":"èš"},
    {"q":"ã€Œã„ã„§ã„ËŠã€ç„¶ä¸åŒçš„ã€Œã„ã„§ã„ËŠã€æ­£ç¢ºå¯«æ³•ï¼Ÿ","a":"è¿¥"},{"q":"è«‹å¯«å‡ºã€Œæ‡¾ã€æœçš„ã€Œæ‡¾ã€","a":"æ‡¾"},
    {"q":"ã€Œã„‘ã„§Ë‹ã€è€Œä¸æ¨çš„ã€Œã„‘ã„§Ë‹ã€æ€éº¼å¯«ï¼Ÿ","a":"å¥‘"},{"q":"æˆèªå¡«ç©ºï¼šã€Œã€‡ã€æ‰‹å¯å¾—","a":"å”¾"},
    {"q":"ã€Œã„’ã„©ã„¢ã€å˜©çš„ã€Œã„’ã„©ã„¢ã€æ­£ç¢ºå¯«æ³•ï¼Ÿ","a":"å–§"},{"q":"è«‹å¯«å‡ºã€Œæ…·æ…¨ã€çš„ã€Œæ…¨ã€","a":"æ…¨"},
    {"q":"ã€Œæƒ†æ‚µã€çš„ã€Œæƒ†ã€æ€éº¼å¯«ï¼Ÿ","a":"æƒ†"},{"q":"æˆèªå¡«ç©ºï¼šã€Œã€‡ã€ç„¶å¤§æ‚Ÿ","a":"æ"},
    {"q":"ã€Œã„†ã„§Ë‡ã€ç¨çš„ã€Œã„†ã„§Ë‡ã€æ­£ç¢ºå¯«æ³•ï¼Ÿ","a":"ç¥"},{"q":"è«‹å¯«å‡ºã€Œè¹™ã€é¡çš„ã€Œè¹™ã€","a":"è¹™"},
    {"q":"ã€Œã„…ã„§Ë‹ã€ç«¯çš„ã€Œã„…ã„§Ë‹ã€æ€éº¼å¯«ï¼Ÿ","a":"å¼Š"},{"q":"æˆèªå¡«ç©ºï¼šã€Œã€‡ã€å¼µè²å‹¢","a":"è™›"},
    {"q":"è«‹å¯«å‡ºã€Œå˜²è«·ã€çš„ã€Œè«·ã€","a":"è«·"},{"q":"ã€Œæ€ æƒ°ã€çš„ã€Œæƒ°ã€æ€éº¼å¯«ï¼Ÿ","a":"æƒ°"},
    {"q":"æˆèªå¡«ç©ºï¼šã€Œã€‡ã€é£›çŒ›é€²","a":"çª"},{"q":"è«‹å¯«å‡ºã€Œè¨•ç¬‘ã€çš„ã€Œè¨•ã€","a":"è¨•"},
    {"q":"æˆèªå¡«ç©ºï¼šã€Œã€‡ã€æœ¨æ±‚é­š","a":"ç·£"},{"q":"è«‹å¯«å‡ºã€Œå«‰å¦’ã€çš„ã€Œå«‰ã€","a":"å«‰"},
    {"q":"ã€Œè­è«·ã€çš„ã€Œè­ã€æ€éº¼å¯«ï¼Ÿ","a":"è­"},{"q":"æˆèªå¡«ç©ºï¼šã€Œã€‡ã€è¡·å…±æ¿Ÿ","a":"åŒ"},
    {"q":"è«‹å¯«å‡ºã€Œæ…°è—‰ã€çš„ã€Œè—‰ã€","a":"è—‰"},{"q":"æˆèªå¡«ç©ºï¼šã€Œã€‡ã€é€”æœ«è·¯","a":"çª®"},
    {"q":"è«‹å¯«å‡ºã€Œç‘•ç–µã€çš„ã€Œç–µã€","a":"ç–µ"},{"q":"ã€Œè©­ã€è¾¯çš„ã€Œè©­ã€æ€éº¼å¯«ï¼Ÿ","a":"è©­"},
    {"q":"æˆèªå¡«ç©ºï¼šã€Œã€‡ã€æ¥µæ³°ä¾†","a":"å¦"},{"q":"è«‹å¯«å‡ºã€Œæ¶æ„ã€çš„ã€Œæ„ã€","a":"æ„"},
    {"q":"ã€Œæ–Ÿé…Œã€çš„ã€Œé…Œã€æ€éº¼å¯«ï¼Ÿ","a":"é…Œ"},{"q":"æˆèªå¡«ç©ºï¼šã€Œã€‡ã€ç“œçˆ›ç†Ÿ","a":"æ»¾"},
    {"q":"è«‹å¯«å‡ºã€Œç™–å¥½ã€çš„ã€Œç™–ã€","a":"ç™–"},{"q":"ã€Œè«‚åªšã€çš„ã€Œè«‚ã€æ€éº¼å¯«ï¼Ÿ","a":"è«‚"},
    {"q":"æˆèªå¡«ç©ºï¼šã€Œã€‡ã€ç„¶ç´™ä¸Š","a":"èº"},{"q":"è«‹å¯«å‡ºã€ŒèŸ„ä¼ã€çš„ã€ŒèŸ„ã€","a":"èŸ„"},
    {"q":"ã€Œã„“ã„¨ã„›ËŠã€ç£¨çš„ã€Œã„“ã„¨ã„›ËŠã€æ­£ç¢ºå¯«æ³•ï¼Ÿ","a":"ç¢"},{"q":"è«‹å¯«å‡ºã€Œå€”å¼·ã€çš„ã€Œå€”ã€","a":"å€”"},
    {"q":"ã€Œå˜®å¨ã€çš„ã€Œå˜®ã€æ€éº¼å¯«ï¼Ÿ","a":"å˜®"},{"q":"æˆèªå¡«ç©ºï¼šã€Œã€‡ã€ä¸å–®è¡Œ","a":"ç¦"},
    {"q":"è«‹å¯«å‡ºã€Œç¶ºéº—ã€çš„ã€Œç¶ºã€","a":"ç¶º"},{"q":"ã€ŒèºŠèº‡ã€çš„ã€Œèº‡ã€æ€éº¼å¯«ï¼Ÿ","a":"èº‡"},
    {"q":"æˆèªå¡«ç©ºï¼šã€Œã€‡ã€ç¾½è€Œæ­¸","a":"é©"},{"q":"è«‹å¯«å‡ºã€Œå—”æ€ªã€çš„ã€Œå—”ã€","a":"å—”"},
    {"q":"ã€Œéœæ™‚ã€çš„ã€Œéœã€æ€éº¼å¯«ï¼Ÿ","a":"éœ"},{"q":"è«‹å¯«å‡ºã€Œçª˜è¿«ã€çš„ã€Œçª˜ã€","a":"çª˜"},
    {"q":"ã€Œè©†æ¯€ã€çš„ã€Œè©†ã€æ€éº¼å¯«ï¼Ÿ","a":"è©†"},{"q":"è«‹å¯«å‡ºã€Œè­´è²¬ã€çš„ã€Œè­´ã€","a":"è­´"},
    {"q":"ã€Œç™±ç˜“ã€çš„ã€Œç™±ã€æ€éº¼å¯«ï¼Ÿ","a":"ç™±"},{"q":"è«‹å¯«å‡ºã€Œå•œæ³£ã€çš„ã€Œå•œã€","a":"å•œ"},
    {"q":"ã€Œæ…«æ¿ã€çš„ã€Œæ…«ã€æ€éº¼å¯«ï¼Ÿ","a":"æ…«"},{"q":"æˆèªå¡«ç©ºï¼šã€Œã€‡ã€è½æœ‰è‡´","a":"éŒ¯"},
    {"q":"è«‹å¯«å‡ºã€Œè¸¹è¸ã€çš„ã€Œè¸¹ã€","a":"è¸¹"},{"q":"ã€Œè³‘ç½ã€çš„ã€Œè³‘ã€æ€éº¼å¯«ï¼Ÿ","a":"è³‘"},
    {"q":"æˆèªå¡«ç©ºï¼šã€Œã€‡ã€ä¸ç¶“å¿ƒ","a":"æ¼«"},{"q":"è«‹å¯«å‡ºã€Œæ•·è¡ã€çš„ã€Œæ•·ã€","a":"æ•·"},
    {"q":"ã€Œèºå‹•ã€çš„ã€Œèºã€æ€éº¼å¯«ï¼Ÿ","a":"èº"},{"q":"æˆèªå¡«ç©ºï¼šã€Œã€‡ã€æ¯ç›¸é—œ","a":"æ¯"},
    {"q":"è«‹å¯«å‡ºã€Œè´…è¿°ã€çš„ã€Œè´…ã€","a":"è´…"},{"q":"ã€Œå˜ˆé›œã€çš„ã€Œå˜ˆã€æ€éº¼å¯«ï¼Ÿ","a":"å˜ˆ"},
    {"q":"æˆèªå¡«ç©ºï¼šã€Œã€‡ã€ç‚ºè§€æ­¢","a":"å˜†"},{"q":"è«‹å¯«å‡ºã€Œæ‚–è«–ã€çš„ã€Œæ‚–ã€","a":"æ‚–"},
    {"q":"ã€Œæˆ•å®³ã€çš„ã€Œæˆ•ã€æ€éº¼å¯«ï¼Ÿ","a":"æˆ•"},{"q":"æˆèªå¡«ç©ºï¼šã€Œã€‡ã€é“è€Œè¡Œ","a":"èƒŒ"},
    {"q":"è«‹å¯«å‡ºã€Œè¸‰è¹Œã€çš„ã€Œè¸‰ã€","a":"è¸‰"},{"q":"ã€Œã„’ã„©ã„¢Ë‹ã€éº—çš„ã€Œã„’ã„©ã„¢Ë‹ã€æ­£ç¢ºå¯«æ³•ï¼Ÿ","a":"çµ¢"},
    {"q":"è«‹å¯«å‡ºã€Œæ£æ‘©ã€çš„ã€Œæ£ã€","a":"æ£"},{"q":"ã€Œã„”ã„¢Ë‹ã€æŠ–çš„ã€Œã„”ã„¢Ë‹ã€æ­£ç¢ºå¯«æ³•ï¼Ÿ","a":"é¡«"},
    {"q":"æˆèªå¡«ç©ºï¼šã€Œã€‡ã€æ¥µè€Œè¡°","a":"ç››"},{"q":"è«‹å¯«å‡ºã€Œè¹‚èºªã€çš„ã€Œèºªã€","a":"èºª"},
    {"q":"æˆèªå¡«ç©ºï¼šã€Œã€‡ã€‡ã€å¤§è¨ˆ","a":"ç™¾å¹´"},{"q":"è«‹å¯«å‡ºã€Œè¤ªè‰²ã€çš„ã€Œè¤ªã€","a":"è¤ª"},
    {"q":"ã€Œç†¾ç†±ã€çš„ã€Œç†¾ã€æ€éº¼å¯«ï¼Ÿ","a":"ç†¾"},{"q":"æˆèªå¡«ç©ºï¼šã€Œã€‡ã€é«˜æ°£æš","a":"è¶¾"},
    {"q":"è«‹å¯«å‡ºã€Œç¥è¦‹ã€çš„ã€Œç¥ã€","a":"ç¥"},{"q":"ã€ŒçŸ¯æ­£ã€çš„ã€ŒçŸ¯ã€æ€éº¼å¯«ï¼Ÿ","a":"çŸ¯"},
    {"q":"æˆèªå¡«ç©ºï¼šä¸€ã€Œã€‡ã€åƒé‡‘","a":"å­—"},{"q":"è«‹å¯«å‡ºã€Œæ†”æ‚´ã€çš„ã€Œæ†”ã€","a":"æ†”"},
    {"q":"æˆèªå¡«ç©ºï¼šã€Œã€‡ã€å£æ¸…é‡","a":"å …"},{"q":"è«‹å¯«å‡ºã€Œè¹‰è·ã€çš„ã€Œè¹‰ã€","a":"è¹‰"},
    {"q":"æˆèªå¡«ç©ºï¼šã€Œã€‡ã€æ­»ä¸€ç”Ÿ","a":"ä¹"},{"q":"è«‹å¯«å‡ºã€Œæ‡Šæ‚”ã€çš„ã€Œæ‡Šã€","a":"æ‡Š"},
    {"q":"ã€Œã„ˆã„ŸË‹ã€å¯¢å¿˜é£Ÿçš„ã€Œã„ˆã„ŸË‹ã€æ­£ç¢ºå¯«æ³•ï¼Ÿ","a":"å»¢"}
];

let db, roomId;
let qIndex=0;
let ctxs=[];

// â”€â”€ Canvas init â”€â”€
window.addEventListener('DOMContentLoaded',()=>{
    for(let i=1;i<=3;i++){
        const cv=document.getElementById(`ac${i}`);
        const wrap=cv.parentElement;
        cv.width=wrap.offsetWidth||300;
        cv.height=wrap.offsetHeight||130;
        const ctx=cv.getContext('2d');
        ctx.lineCap='round';ctx.lineJoin='round';
        ctx.strokeStyle='#FF6B35';ctx.lineWidth=2.5;
        ctxs[i-1]=ctx;
    }
});

// â”€â”€ Connect â”€â”€
function connectAdmin(){
    const dbUrl=document.getElementById('dbUrl').value.trim();
    const apiKey=document.getElementById('apiKey').value.trim();
    const roomIn=document.getElementById('roomInput').value.trim();
    const msg=document.getElementById('statusMsg');

    if(!dbUrl||!apiKey||!roomIn){
        setMsg('è«‹å¡«å…¥æ‰€æœ‰æ¬„ä½','err');return;
    }
    if(roomIn.length!==4||!/^\d+$/.test(roomIn)){
        setMsg('æˆ¿é–“ä»£è™Ÿå¿…é ˆæ˜¯ 4 ä½æ•¸å­—','err');return;
    }

    setMsg('é€£ç·šä¸­...');
    try{
        if(firebase.apps.length===0){
            firebase.initializeApp({apiKey,databaseURL:dbUrl,
                projectId:dbUrl.replace('https://','').split('.')[0]});
        }
        db=firebase.database();
        roomId=roomIn;

        // Check room exists
        db.ref(`rooms/${roomId}/status`).once('value',snap=>{
            if(!snap.exists()||snap.val()==='ended'){
                setMsg('æ‰¾ä¸åˆ°è©²æˆ¿é–“ï¼Œè«‹ç¢ºèªä»£è™Ÿ','err');return;
            }
            // Mark admin as connected
            db.ref(`rooms/${roomId}/connections/admin`).set(true);
            db.ref(`rooms/${roomId}/connections/admin`).onDisconnect().set(false);

            setMsg('å·²é€£ç·š âœ“','ok');
            document.getElementById('connPanel').style.display='none';
            document.getElementById('ctrl').classList.add('active');

            listenStrokes();
            listenResults();
            listenAppeals();
        });
    }catch(e){setMsg('éŒ¯èª¤ï¼š'+e.message,'err');}
}

function listenStrokes(){
    for(let i=1;i<=3;i++){
        const pi=i;
        db.ref(`rooms/${roomId}/strokes/p${i}`).on('child_added',snap=>{
            drawStroke(pi,snap.val());
        });
    }
}

function listenResults(){
    for(let i=1;i<=3;i++){
        const pi=i;
        db.ref(`rooms/${roomId}/results/p${i}`).on('value',snap=>{
            const r=snap.val();
            if(r&&r.character) document.getElementById(`pa${pi}`).textContent=r.character;
        });
    }
}

function listenAppeals(){
    db.ref(`rooms/${roomId}/appeals`).on('child_added',snap=>{
        const a=snap.val();
        if(!a)return;
        const n=a.playerNumber;
        document.getElementById(`pi${n}`).classList.add('appeal');
        document.getElementById(`ab${n}`).style.display='inline-block';
        document.getElementById(`ob${n}`).style.display='flex';
    });
}

function drawStroke(n,s){
    const cv=document.getElementById(`ac${n}`);
    const ctx=ctxs[n-1];
    if(!cv||!ctx)return;
    ctx.beginPath();
    ctx.moveTo(s.x*cv.width,s.y*cv.height);
    ctx.lineTo(s.x2*cv.width,s.y2*cv.height);
    ctx.stroke();
}

// â”€â”€ Game control â”€â”€
function nextQuestion(){
    if(qIndex>=QUESTIONS.length){alert('æ‰€æœ‰é¡Œç›®å·²å®Œæˆï¼');return;}
    const q=QUESTIONS[qIndex];

    document.getElementById('curQ').textContent=qIndex+1;
    document.getElementById('qText').textContent=q.q;
    document.getElementById('ansText').textContent=q.a;
    document.getElementById('qBox').style.display='block';
    document.getElementById('progFill').style.width=((qIndex+1)/QUESTIONS.length*100)+'%';

    // Clear player UI
    for(let i=1;i<=3;i++){
        document.getElementById(`pa${i}`).textContent='---';
        document.getElementById(`pi${i}`).classList.remove('appeal');
        document.getElementById(`ab${i}`).style.display='none';
        document.getElementById(`ob${i}`).style.display='none';
        // Clear canvas
        const cv=document.getElementById(`ac${i}`);
        if(ctxs[i-1]&&cv)ctxs[i-1].clearRect(0,0,cv.width,cv.height);
    }

    // Push to Firebase
    db.ref(`rooms/${roomId}/currentQuestion`).set({
        number:qIndex+1,text:q.q,answer:q.a,ts:Date.now()
    });

    qIndex++;
}

function override(n,correct){
    db.ref(`rooms/${roomId}/overrides`).push({playerNumber:n,correct,ts:Date.now()});
    document.getElementById(`pi${n}`).classList.remove('appeal');
    document.getElementById(`ab${n}`).style.display='none';
    document.getElementById(`ob${n}`).style.display='none';
}

function setMsg(text,type=''){
    const el=document.getElementById('statusMsg');
    el.textContent=text;el.className='status-msg'+(type?' '+type:'');
}
</script>
</body>
</html>
